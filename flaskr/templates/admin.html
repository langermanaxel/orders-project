{% extends 'base.html' %}
{% block content %}
<h2>Panel Admin</h2>

<form action="{{ url_for('auth.logout') }}" method="post" class="inline">
  <button type="submit">Cerrar sesión</button>
</form>

<section class="grid">
  <div class="card">
    <h3>Productos</h3>
    <form action="{{ url_for('admin.add_product') }}" method="post" class="row">
      <input type="text" name="name" placeholder="Nombre" required>
      <input type="number" step="0.01" name="price" placeholder="Precio" required>
      <input type="text" name="category" placeholder="Categoría (opcional)">
      <button type="submit">Agregar</button>
    </form>

    <table>
      <thead><tr><th>Nombre</th><th>Categoría</th><th>Precio</th><th></th></tr></thead>
      <tbody>
      {% for p in products %}
        <tr>
          <td>{{ p.name }}</td>
          <td>{{ p.category or '-' }}</td>
          <td>$ {{ '%.0f'|format(p.price) }}</td>
          <td>
            <form action="{{ url_for('admin.delete_product', pid=p.id) }}" method="post">
              <button type="submit" class="danger">Eliminar</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3>Últimos pedidos</h3>
    <table>
      <thead><tr><th>#</th><th>Cliente</th><th>Items</th><th>Total</th><th>Estado</th><th>Acción</th></tr></thead>
      <tbody>
      {% for o, items in orders %}
        <tr>
          <td>#{{ o.id }}</td>
          <td>{{ o.customer_name }}</td>
          <td>
            {% if items %}
              <ul class="items">
                {% for it in items %}
                  <li>{{ it.name if it.name else it['name'] }} x{{ it.qty if it.qty else it['qty'] }}</li>
                {% endfor %}
              </ul>
            {% else %}
              -
            {% endif %}
          </td>
          <td>$ {{ '%.0f'|format(o.total) }}</td>
          <td>{{ o.status }}</td>
          <td>
            <form action="{{ url_for('admin.update_order_status', oid=o.id) }}" method="post" class="row">
              <select name="status">
                <option value="pending" {{ 'selected' if o.status=='pending' else '' }}>pending</option>
                <option value="in_progress" {{ 'selected' if o.status=='in_progress' else '' }}>in_progress</option>
                <option value="ready" {{ 'selected' if o.status=='ready' else '' }}>ready</option>
                <option value="delivered" {{ 'selected' if o.status=='delivered' else '' }}>delivered</option>
                <option value="cancelled" {{ 'selected' if o.status=='cancelled' else '' }}>cancelled</option>
              </select>
              <button type="submit">Actualizar</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
